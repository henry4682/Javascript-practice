<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products & Cart</title>
    <link rel="stylesheet" href="Products&cart.css">
    <script src="https://kit.fontawesome.com/d6cd84efbe.js" crossorigin="anonymous"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js' integrity='sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==' crossorigin='anonymous'></script>
</head>
<body>
    <header>
        <h1>Javascript & jQuery Practice</h1>
    </header>
    <aside class="menu">
        <ul>
          <li class="home-page">
              <a href="https://henry4682.github.io/Javascript-practice/">首頁</a>
          </li>
          <li>
            <a
              href="https://henry4682.github.io/Javascript-practice/BMI_calculator/"
              >BMI calculator</a
            >
          </li>
          <li>
            <a href="https://henry4682.github.io/Javascript-practice/Calculator/"
              >Calculator</a
            >
          </li>
          <li>
            <a
              href="https://henry4682.github.io/Javascript-practice/Free_Wifi_Search/"
              >Free Wifi Search</a
            >
          </li>
          <li>
            <a href="https://henry4682.github.io/Javascript-practice/TODO_List/"
              >TODO list</a
            >
          </li>
        </ul>
    </aside>
    <main>
        <section class="products">
            <h2>商品列表</h2>
            <table class="products-table" >
                <thead>
                    <tr>
                        <th>商品編號</th>
                        <th>商品名稱</th>
                        <th>商品價格</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </section>
        <section class="cart">
            <h2>購物車</h2>
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>商品編號</th>
                        <th>商品名稱</th>
                        <th>商品價格</th>
                        <th>商品數量</th>
                        <th>商品小計</th>
                        <th>刪除商品</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="total" >總計:<p >0</p>元</td> 
                    </tr>
                </tbody>
            </table>
        </section>
    </main>
   
    <script>
        
        $(function(){
            var fruits = [
            {
                Product_number : 0001,
                Product_name : 'apple',
                Product_price : 50,
            },
            {
                Product_number : 0002,
                Product_name : 'banana',
                Product_price : 15,
            },
            {
                Product_number : 0003,
                Product_name : 'orange',
                Product_price : 25,
            },
        ]
            $('.products-table tbody').append(fruits.map((item, i) => 
                `<tr>
                    <td class='Product_number'>${item.Product_number}</td>    
                    <td>${item.Product_name}</td>    
                    <td>${item.Product_price}</td>    
                    <td><button class='addCart'>加入購物車</button></td>    
                </tr>`
            ))
            var total = 0; 
            $('.products-table tbody').on('click', '.addCart', (e) => {
                var $itemNum = $(e.target).parent().siblings('td:eq(0)').text();
                var $itemName = $(e.target).parent().siblings('td:eq(1)').text();
                var $itemPrice = $(e.target).parent().siblings('td:eq(2)').text();
                
                var flag = false
                $('.cart-table tbody td.product-name').each(function(){
                    var $productName = $(this).text();
                    if($productName == $itemName) {
                        flag = true;
                    }
                })
                if(flag) return;
                
                $('.cart-table tbody').prepend(`
                <tr>
                    <td>${$itemNum}</td>
                    <td class='product-name'>${$itemName}</td> 
                    <td>${$itemPrice}</td> 
                    <td class='amount'><button class='addAmount'>+</button><p>1</p><button class='subAmount'>-</button></td>
                    <td class='subTotal'>${$itemPrice}</td>
                    <td><button class='deleteBtn'>刪除商品</button></td>    
                </tr>`)
                
                total += +$itemPrice
                $('.cart-table tbody td.total p').text(total)
            })
            // 增加或減少商品數量按鈕
            $('.cart-table').on('click','.addAmount, .subAmount',(e) => {
                let amount = Number($(e.target).siblings('p').text())
                let price = Number($(e.target).parent().siblings('td:eq(2)').text())
                if($(e.target).is('.addAmount')){
                    amount += 1
                    total += price
                }else{
                    if(amount <= 1)return
                    amount -= 1
                    total -= price
                }
                
                price *= amount
                $(e.target).siblings('p').text(amount)
                $(e.target).parent().siblings('td:eq(3)').text(price)
                $('.cart-table tbody td.total p').text(total)
            })
            // 購物車刪除按鈕
            $('.cart-table tbody').on('click','td button.deleteBtn',(e) => {
                let subtotal = Number($(e.target).parent().siblings('td:eq(4)').text())
                total -= subtotal
                $('.cart-table tbody td.total p').text(total)
                $(e.target).parent().parent().remove()
            })
        })
    </script>
</body>
</html>